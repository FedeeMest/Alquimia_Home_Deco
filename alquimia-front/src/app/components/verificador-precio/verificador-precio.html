<div class="min-h-[80vh] flex flex-col items-center justify-center p-4" (click)="mantenerFoco()">
    
    <h2 class="text-2xl font-bold text-slate-800 mb-6">Buscar Precio</h2>

    <div *ngIf="mostrarCamara" class="w-full max-w-md mb-6 overflow-hidden rounded-2xl shadow-2xl bg-black relative h-80">
        <zxing-scanner 
            [formats]="formatosAdmitidos"
            (scanSuccess)="onCodigoEscaneado($event)"
            class="w-full h-full object-cover"
        ></zxing-scanner>
        
        <button (click)="toggleCamara()" class="absolute top-4 right-4 bg-white/20 hover:bg-white/40 text-white px-4 py-2 rounded-full backdrop-blur-md font-bold text-sm border border-white/30 z-50">
            ✕ CERRAR
        </button>
        
        <div class="absolute bottom-4 left-0 right-0 text-center pointer-events-none">
            <span class="bg-black/50 text-white px-3 py-1 rounded-full text-xs backdrop-blur-sm">Apuntá al código</span>
        </div>
    </div>

    <div class="w-full max-w-lg mb-6 relative" *ngIf="!mostrarCamara">
        
        <button 
            (click)="toggleCamara()"
            class="w-full mb-4 bg-slate-800 hover:bg-slate-700 text-white py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 active:scale-95 transition-transform"
        >
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z" />
            </svg>
            Escanear con Cámara
        </button>

        <div class="relative">
             <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-slate-400">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5h.75v.75h-.75v-.75ZM13.5 19.5h.75v.75h-.75v-.75ZM19.5 13.5h.75v.75h-.75v-.75ZM19.5 19.5h.75v.75h-.75v-.75ZM16.5 16.5h.75v.75h-.75v-.75Z" />
                </svg>
            </div>
            <input 
                #scanInput
                type="text" 
                [(ngModel)]="codigoLeido" 
                (keyup.enter)="buscar()"
                (blur)="mantenerFoco()"
                placeholder="O escribe el código..." 
                class="block w-full pl-10 pr-3 py-4 border-2 border-slate-300 rounded-xl leading-5 bg-white placeholder-slate-400 focus:outline-none focus:border-slate-500 focus:ring-slate-500 sm:text-xl text-center shadow-lg transition-all"
            >
        </div>
    </div>

    <div *ngIf="!producto" class="text-center transition-all duration-300">
         <div *ngIf="error" class="text-red-500 text-xl font-bold mb-2 animate-bounce">
            ✕ {{ mensaje }}
        </div>
        <div *ngIf="!error" class="text-slate-400 text-lg">
            {{ mensaje }}
        </div>
    </div>

    <div *ngIf="producto" class="w-full max-w-3xl bg-white rounded-2xl shadow-2xl overflow-hidden animate-fade-in-up border border-slate-100">
         <div class="bg-slate-900 p-6 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-white tracking-tight">
                {{ producto.nombre }}
            </h1>
            <p class="text-slate-400 mt-2 font-mono text-lg">
                {{ producto.codigo_barra }} | {{ producto.categoria || 'General' }}
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 divide-y md:divide-y-0 md:divide-x divide-slate-100">
            <div class="p-8 text-center bg-emerald-50/50">
                <span class="inline-block px-3 py-1 bg-emerald-100 text-emerald-800 rounded-full text-xs font-bold uppercase tracking-wide mb-3">Efectivo</span>
                <div class="text-5xl font-bold text-emerald-600 font-mono tracking-tighter">{{ producto.precio_efectivo | currency:'ARS':'symbol-narrow':'1.0-0' }}</div>
            </div>
            
            <div class="p-8 text-center bg-blue-50/50">
                <span class="inline-block px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-bold uppercase tracking-wide mb-3">Tarjeta Local</span>
                <div class="text-4xl font-bold text-blue-600 font-mono tracking-tighter">{{ producto.precio_tarjeta_local | currency:'ARS':'symbol-narrow':'1.0-0' }}</div>
                <p class="text-blue-800/60 text-sm mt-2 font-medium">+{{ recargoLocal }}% Recargo</p>
            </div>
            
            <div class="p-8 text-center bg-white">
                <span class="inline-block px-3 py-1 bg-slate-100 text-slate-800 rounded-full text-xs font-bold uppercase tracking-wide mb-3">Tarjeta</span>
                <div class="text-4xl font-bold text-slate-700 font-mono tracking-tighter">{{ producto.precio_tarjeta | currency:'ARS':'symbol-narrow':'1.0-0' }}</div>
                <p class="text-slate-500 text-sm mt-2 font-medium">+{{ recargoTarjeta }}% Recargo</p>
            </div>
         </div>
         
         <div class="bg-slate-50 p-4 font-bold text-center border-t border-slate-100 ">
            <p class="text-slate-400 text-sm">Escanea el siguiente producto para limpiar la pantalla</p>
        </div>
    </div>

</div>